name: âœ… Reliable CI Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

env:
  NODE_VERSION: '20'
  
jobs:
  ci:
    name: ğŸ”§ Build, Test & Deploy
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 1

    - name: ğŸ—ï¸ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'
        cache-dependency-path: package-lock.json

    - name: ğŸ“¦ Install Dependencies
      run: |
        npm ci --prefer-offline --no-audit
        echo "âœ… Dependencies installed successfully"

    - name: ğŸ” Type Check
      run: |
        npm run type-check
        echo "âœ… TypeScript compilation successful"

    - name: ğŸ§ª Run Tests
      run: |
        npm test -- --reporter=verbose
        echo "âœ… All tests passed"

    - name: ğŸ—ï¸ Build Production
      run: |
        npm run build
        echo "âœ… Production build completed"
        echo "ğŸ“Š Build artifacts:"
        ls -lh dist/assets/ | head -5

    - name: ğŸ‰ Success Summary
      run: |
        echo "ğŸ¯ CI Pipeline Completed Successfully!"
        echo "âœ… TypeScript: No errors"
        echo "âœ… Tests: All passing"
        echo "âœ… Build: Production ready"
        echo "ğŸš€ Ready for deployment"
